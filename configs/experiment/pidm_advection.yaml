# PIDM on 2D linear advection
#
# Usage:
#   python scripts/run_experiment.py --model pidm --config configs/experiment/pidm_advection.yaml --device auto

# --- Data loading ---------------------------------------------------------
data:
  type: advection
  path: datasets/synthetic/advection_data_2d.npy
  spatial_stride: 8          # 8Ã—8 = 64 features
  temporal_stride: 1
  window_size: 64
  window_stride: 8
  normalise: true
  miss_ratio: 0.1
  mask_strategy: random

# --- Dimensions -----------------------------------------------------------
seq_len: 64
batch_size: 16

# --- PIDM model config ----------------------------------------------------
pidm:
  diff_steps: 100
  unet:
    dim: 64                  # base channel width
    dim_mults: [1, 2, 4]     # channel multipliers per resolution stage
    channels: 1              # UNet input channels (data reshaped to 1-channel images)
    attn_heads: 4
    attn_dim_head: 32
    padding_mode: zeros
  # Physics loss weights (pure data-driven for advection baseline)
  c_data: 1.0
  c_residual: 0.0           # set > 0 to enable physics-informed residual
  c_ineq: 0.0
  lambda_opt: 0.0
  # Training loop (iteration-based, matching main.py)
  train_iterations: 100000   # fewer than default 300K for faster experiments
  lr: 0.0001
  grad_clip: 1.0
  ema_decay: 0.99
  ema_start: 1000
  log_freq: 500

# --- Training -------------------------------------------------------------
training:
  save_dir: results/checkpoints/pidm_advection

# --- Evaluation -----------------------------------------------------------
evaluation:
  n_samples: 10
  save_dir: results/metrics/pidm_advection

# --- Diagnostics ----------------------------------------------------------
diagnostics:
  semigroup:
    t1: 16
    t2: 16
  conservation: true
  horizon:
    horizons: [8, 16, 32, 48]
    context_len: 16
  sparsity:
    miss_ratios: [0.1, 0.2, 0.3, 0.5, 0.7]
